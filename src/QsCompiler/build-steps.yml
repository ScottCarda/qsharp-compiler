##
# Build, test and pack the compiler
##
steps:

- task: DotNetCoreCLI@2
  displayName: 'Build and test Q# compiler and language server'
  inputs:
    command: test
    arguments: '-c $(BuildConfiguration) -v $(Build.Verbosity)  /p:DefineConstants=$(Assembly.Constants) /p:Version=$(Assembly.Version)'
    projects: '$(CompilerSrcDir)/../QsCompiler.sln'
    

- task: DotNetCoreCLI@2
  displayName: 'Publish Q# command line compiler'
  inputs:
    command: publish
    arguments: '-c $(BuildConfiguration) -v $(Build.Verbosity)  /p:DefineConstants=$(Assembly.Constants) /p:Version=$(Assembly.Version)'
    publishWebProjects: false
    projects: $(CompilerSrcDir)/CommandLineTool/QsCommandLineTool.csproj
    zipAfterPublish: false
    modifyOutputPath: false


- task: DotNetCoreCLI@2
  displayName: 'Publish Q# language server'
  inputs:
    command: publish
    arguments: '-c $(BuildConfiguration) -v $(Build.Verbosity)  /p:DefineConstants=$(Assembly.Constants) /p:Version=$(Assembly.Version)'
    publishWebProjects: false
    projects: $(CompilerSrcDir)/LanguageServer/QsLanguageServer.csproj
    zipAfterPublish: false
    modifyOutputPath: false
